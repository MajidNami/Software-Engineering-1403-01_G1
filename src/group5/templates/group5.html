<!DOCTYPE html>
{% load static %}
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحه خانه</title>
    <link rel="stylesheet" href="{% static 'base/home_style.css' %}">
    <style>
        /* Styles for the pop-up */
        .popup {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%; /* Full width */
            max-height: 30%; /* Adjusted height */
            overflow-y: auto;
            padding: 10px;
            background: #fff;
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border-top: 2px solid #ccc;
            border-radius: 10px 10px 0 0;
            font-family: Arial, sans-serif;
            resize: vertical;
            overflow: auto; /* Allow scroll for content */
        }

        .popup h2 {
            font-size: 16px;
            margin: 0;
        }

        .popup .close {
            cursor: pointer;
            color: red;
            float: right;
            font-size: 20px;
            font-weight: bold;
        }

        .popup .search-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .popup .search-container input {
            width: 6cm;
            padding: 5px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px 0 0 5px;
        }

        .popup .search-container button {
            padding: 5px;
            font-size: 14px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup .search-container button img {
            width: 20px;
            height: 20px;
        }

        .popup .search-container button:hover {
            background: #0056b3;
        }

        .popup-content {
            font-size: 14px;
            line-height: 1.6;
        }

        .popup-content ul {
            padding-left: 20px;
        }

        .popup-content li {
            margin-bottom: 5px;
        }

        /* Divider */
        .divider {
            border-top: 2px solid purple;
            margin: 10px 0;
        }

        /* Voice Icon */
        .voice-icon {
            display: inline-block;
            width: 32px;
            height: 32px;
            margin-left: 10px;
            cursor: pointer;
        }

        .voice-icon img {
            width: 32px;
            height: 32px;
        }

        /* Highlight background for meanings */
        .meanings {
            background-color: #fff9c4; /* Light yellow */
            padding: 10px;
            border-radius: 5px;
        }

        /* Loading indicator */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
        }

        .loading img {
            display: block;
            margin: 0 auto;
            width: 300px; /* 4x size */
            height: 300px; /* 4x size */
        }

        /* Blurred background when loading */
        .blurred {
            filter: blur(5px);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="welcome-container" id="mainContent">
        <h1>خوش آمدید به گروه {{ group_number }}
            میکروسرویس خود را اینجا توسعه دهید
        </h1>
        <p id="content">This is a passage for testing:
        The curious fox wandered cautiously through the dense forest, its sleek fur glinting under the pale moonlight. Every rustle of the leaves and every distant howl heightened its vigilance. The fox’s quest was for a small stream, a source of refreshment in the otherwise parched wilderness. Along the way, it stumbled upon an abandoned cottage, its rickety door creaking in the cold night breeze. Intrigued but wary, the fox peeked inside, only to find a trove of dusty artifacts scattered across the floor—remnants of a time long past.</p>
    </div>

    <!-- Loading Indicator -->
    <div class="loading" id="loading">
        <img src="https://i.gifer.com/YCZH.gif" alt="Loading">
    </div>

    <!-- Pop-up Window -->
    <div class="popup" id="popup" style="display: none;">
        <span class="close" id="closePopup">&times;</span>
        <div style="background-color: darkgreen; padding: 10px; border-radius: 5px;">
            <h2>Word Details</h2>
            <div class="search-container">
                <input type="text" id="searchBox" placeholder="Enter a word to search">
                <button id="searchButton">
                    <img src="https://img.icons8.com/ios-filled/50/000000/search--v1.png" alt="Search">
                </button>
            </div>
        </div>
        <div class="divider"></div>
        <div class="popup-content" id="popupContent">
            <!-- Dynamic content will be injected here -->
        </div>
    </div>

    <script>
        document.getElementById('content').addEventListener('dblclick', async function () {
            const selection = window.getSelection();
            const word = selection.toString().trim();

            if (word) {
                showLoading();
                await fetchAndDisplayWord(word);
                hideLoading();
            }
        });

        async function fetchAndDisplayWord(word) {
            try {
                const response = await fetch(`./dictionary/${word}`);
                if (response.ok) {
                    const data = await response.json();
                    const formattedContent = formatWordDetails(data);
                    document.getElementById('popupContent').innerHTML = formattedContent;
                    document.getElementById('popup').style.display = 'block';
                } else {
                    document.getElementById('popupContent').innerHTML = '<p>Word not found.</p>';
                    document.getElementById('popup').style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching word:', error);
                document.getElementById('popupContent').innerHTML = '<p>An error occurred.</p>';
                document.getElementById('popup').style.display = 'block';
            }
        }

        function formatWordDetails(data) {
            let content = `<p><strong>Term:</strong> ${data.term}</p><div class='divider'></div>`;

            if (data.us_phonetic || data.uk_phonetic) {
                content += '<p><strong>Phonetics:</strong></p><ul>';
                if (data.us_phonetic) {
                    content += `<li>US: ${data.us_phonetic.text} <span class="voice-icon"><img src="https://img.icons8.com/ios-filled/50/000000/speaker.png" alt="Play" onclick="playAudio('${data.us_phonetic.audio_url}')"></span></li>`;
                }
                if (data.uk_phonetic) {
                    content += `<li><span style="border: 2px solid red; padding: 2px;">UK: ${data.uk_phonetic.text} </span><span class="voice-icon"><img src="https://img.icons8.com/ios-filled/50/000000/speaker.png" alt="Play" onclick="playAudio('${data.uk_phonetic.audio_url}')"></span></li>`;
                }
                content += '</ul><div class="divider"></div>';
            }

            if (data.meanings && data.meanings.length > 0) {
                content += '<div class="meanings"><p><strong>Meanings:</strong></p><ul>';
                data.meanings.forEach(meaning => {
                    content += `<li><strong>${meaning.partOfSpeech}:</strong><ul>`;
                    meaning.definitions.forEach(def => {
                        content += `<li>${def.definition}`;
                        if (def.example) {
                            content += ` <em>(e.g., ${def.example})</em>`;
                        }
                        content += '</li>';
                    });
                    content += '</ul></li>';
                });
                content += '</ul></div><div class="divider"></div>';
            }
            // synonyms and antonyms:
            if (data.synonyms && data.synonyms.length > 0) {
                content += '<div class="meanings"><p><strong>Synonyms:</strong></p><p>';
                content += data.synonyms.join(', ');
                content += '</p></div><div class="divider"></div>';
            }
            if (data.antonyms && data.antonyms.length > 0) {
                content += '<div class="meanings"><p><strong>Antonyms:</strong></p><p>';
                content += data.antonyms.join(', ');
                content += '</p></div><div class="divider"></div>';
            }

            return content;
        }

        function playAudio(url) {
            const audio = new Audio(url);
            audio.play();
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('mainContent').classList.add('blurred');
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainContent').classList.remove('blurred');
        }

        document.getElementById('closePopup').addEventListener('click', function () {
            document.getElementById('popup').style.display = 'none';
        });

        document.getElementById('searchButton').addEventListener('click', function () {
            const searchWord = document.getElementById('searchBox').value.trim();
            if (searchWord) {
                showLoading();
                fetchAndDisplayWord(searchWord).then(hideLoading);
            }
        });

        document.getElementById('searchBox').addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                const searchWord = document.getElementById('searchBox').value.trim();
                if (searchWord) {
                    showLoading();
                    fetchAndDisplayWord(searchWord).then(hideLoading);
                }
            }
        });
        </script>
    </body>
</html>
